// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Category {
  id          String     @id
  title       String     @unique @default("")
  description String?    @db.Text
  status      String     @default("DEACTIVATED")
  parentId    String?
  parent      Category?  @relation("CategoryToParent", fields: [parentId], references: [id], onDelete: Cascade)
  children    Category[] @relation("CategoryToParent")

  @@map("categories")
}


model AnnounceManagement {
  id        String @id
  status    String @default("DEACTIVATED")
  announceType String @default("NORMAL")

  categoryId String
  userId     String

  @@map("announce_management")
}

model AnnounceInfo {
  id        String @id
  title String
  description String

  announceId String

  @@map("announce_info")
}

model AnnounceImages {
  id     String @id @default(uuid())
  weight Int
  url    String

  announceId String

  @@map("announce_images")
}


model StockNormalManual {
  id                      String @id
  stock                   Int    @default(0)
  stockNormalManagementId String @unique()

  @@map("stock_normal_manual")
}

model StockNormalAuto {
  id                      String @id
  value                   String @default("")
  stockNormalManagementId String

  @@map("stock_normal_auto")
}

model StockNormalManagement {
  id        String @id
  stockType String @default("NORMAL")

  announceNormalId String @unique()

  @@map("stock_normal_management")
}


model User {
  id       String @id @default(uuid())
  username String @unique
  email    String @unique
  password String

  @@map("users")
}

model Order {
  id     String @id @default(uuid())
  status String
  userId String

  @@map("orders")
}

model OrderItems {
  id         String @id @default(uuid())
  quantity   Int
  unitPrice  Float
  orderId    String
  announceId String

  @@map("order_items")
}

model StockItemManagement {
  id             String @id @default(uuid())
  stockItemType  String
  announceItemId String @unique()

  @@map("stock_item_management")
}

model StockItemManual {
  id                    String @id @default(uuid())
  stock                 Int
  stockItemManagementId String @unique()

  @@map("stock_item_manual")
}

model StockItemAuto {
  id                    String @id @default(uuid())
  value                 String
  stockItemManagementId String

  @@map("stock_item_auto")
}

model EventConsumer {
  id           String @id @default(uuid())
  eventId      String
  consumerName String

  @@unique([eventId, consumerName])
  @@map("event_consumer")
}

model Outbox {
  id            String   @id @default(uuid())
  payload       String   @db.Text
  eventName     String
  timestamp     DateTime
  status        String   @default("PENDING")
  error_message String   @default("PENDING")
  retry_count   Int      @default(0)

  @@map("outbox")
}

model ChatDelivery {
  id         String @id @default(uuid())
  salesmanId String
  customerId String
  orderId    String
  status     String

  @@map("chat-delivery")
}

model ChatDeliveryMessage {
  id           String   @id @default(uuid())
  authorId     String
  chatId       String
  content      String?
  dateTimeSent DateTime

  @@map("chat-delivery-message")
}

model ChatDeliveryMessageAttachment {
  id                    String @id @default(uuid())
  type                  String
  attachment            String
  chatDeliveryMessageId String

  @@map("chat-delivery-message-attachment")
}
